<!DOCTYPE html>
<html>
<head>
  <!--test-->  
    <title>DGIdb Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        select, input, button { font-size: 16px; margin: 5px 0; }
        pre { background: #f4f4f4; padding: 10px; }
        .error { color: red; }
    </style>

    <!--For navbar-->
    <link rel="stylesheet" type="text/css" href="../static/nav.css" >
        <!--Google Fonts-->
    <link href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">

</head>
<body>

    <nav>
        <a href="/" class="title">DGIT</a>
        <div class="menu container">
            <a href="search.html" class="menu" >Search</a>
            <a href="/about" class="menu">About</a>
            <a href="/db" class="menu">Database</a>
            <a href="/contact" class="menu" >Contact</a>
        </div>
    </nav>

    <h1>Gene-Drug Interaction Search</h1>

    {% if error %}
    <p class="error">{{ error }}</p>
    {% endif %}

    <form method="POST" action="/">
        <input type="text" name="query" placeholder="Enter gene or drug">

        <select name="type" required>
        <option value="" disabled
            {% if not (search_type if search_type is defined else request.form.get('type')) %}selected{% endif %}>
            Select type
        </option>
        <option value="gene"
            {% if (search_type if search_type is defined else request.form.get('type')) == 'gene' %}selected{% endif %}>
            Gene
        </option>
        <option value="drug"
            {% if (search_type if search_type is defined else request.form.get('type')) == 'drug' %}selected{% endif %}>
            Drug
        </option>
        <option value="protein"
            {% if (search_type if search_type is defined else request.form.get('type')) == 'protein' %}selected{% endif %}>
            Protein
        </option>
        </select>
        <button type="submit">Search</button>
    </form>

    {% if mdd_list %}
        <h3>Common MDD {{ 'Genes' if (search_type or request.form.get('type')) == 'gene' else 'Drugs' }}</h3>
        <div style="display:flex; flex-wrap:wrap; gap:.4rem; margin:.5rem 0;">
            {% for item in mdd_list %}
            <span style="border:1px solid #ddd; padding:.1rem .5rem; border-radius:999px;">{{ item }}</span>
            {% endfor %}
        </div>
    {% endif %}


    {% if results %}
        {% if not (rows and rows|length > 0) %}
            <h2>Results</h2>
        {% endif %}

        {% if rows and search_type == 'protein' %}
            <h2>Associated Genes</h2>
            <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%;">
                <thead>
                <tr>
                    <th>Short Name</th>
                    <th>Protein</th>
                    <th>UniProt ID</th>
                    <th>Organism</th>
                    <th>Associated Genes</th>
                </tr>
                </thead>
                <tbody>
                {% for r in rows %}
                <tr>
                    <td>{{ r.protein_name or "—" }}</td>
                    <td>{{ r.description or "—" }}</td>
                    <td>{{ r.uniprot_id or "—" }}</td>
                    <td>{{ r.organism or "—" }}</td>
                    <td>{{ r.genes }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}


        {% if rows and rows|length > 0 and search_type != 'protein'%}
            <h2>Results</h2>
            <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%;">
                    <thead>
                    <tr>
                        <th>{{ rows[0].left_label }}</th>
                        <th>{{ rows[0].right_label }}</th>
                        <th>Types</th>
                        <th>Direction</th>
                        <th>Score</th>
                        <th>Sources</th>
                        <th>PMIDs</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for r in rows %}
                        <tr>
                        <td><strong>{{ r.left_name or '—' }}</strong><br><small style="color:#666">{{ r.left_cid or '' }}</small></td>
                        <td><strong>{{ r.right_name or '—' }}</strong><br><small style="color:#666">{{ r.right_cid or '' }}</small></td>
                        <td>{{ r.types }}</td>
                        <td>{{ r.directions }}</td>
                        <td>{{ r.score if r.score is not none else '—' }}</td>
                        <td>{{ r.sources }}</td>
                        <td>{{ r.pmids }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% elif (search_type or request.form.get('type')) and not mdd_list %}
                <p>No results.</p>
            {% endif %}
            <details style="margin-top:1rem;">
                <summary>Raw Response (debug)</summary>
                <pre>{{ results | tojson(indent=2) }}</pre>
            </details>
        {% endif %}
</body>
</html>
