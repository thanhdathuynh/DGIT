<!DOCTYPE html>
<html>
<head>
    <title>Contact Us</title>
    
    <!-- Navigation Styles -->
    <link rel="stylesheet" type="text/css" href="../static/nav.css">
    <link rel="stylesheet" type="text/css" href="../static/contact.css">
    <link rel="stylesheet" type="text/css" href="../static/ai-chatbot.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <a href="/" class="title">DGIT</a>
        <div class="menu container">
            <a href="/search" class="menu">Search</a>
            <a href="/about" class="menu">About</a>
            <a href="/db" class="menu">Database</a>
            <a href="/contact" class="menu">Contact</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="page-container">
        <h1 class="page-title">Contact Us</h1>
        <p class="page-subtitle">Want to get in touch? We'd love to hear from you. Here's how you can reach us.</p>
        
        <div class="content-wrapper">
            <!-- Company Information -->
            <div class="info-box">
                <h2 class="info-title">Our Information</h2>
                
                <div class="info-section">
                    <div class="info-label">Email</div>
                    <div class="info-text">
                        <a href="mailto:DGIT@sjsu.edu">DGIT@sjsu.edu</a>
                    </div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">About DGIT</div>
                    <div class="info-text">
                        DGIT is a comprehensive platform for exploring drug-gene interactions related to Major Depressive Disorder (MDD). We provide researchers and healthcare professionals with easy access to interaction data, protein information, and AI-powered insights.
                    </div>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="contact-box">
            {% if success %}
            <div class="success-message">
                Thank you for your message! We'll get back to you soon.
            </div>
            {% endif %}
            
            {% if error %}
            <div class="error-message">
                {{ error }}
            </div>
            {% endif %}
            
            <form method="POST" action="/contact">
                <div class="form-group">
                    <label for="name" class="form-label">Name *</label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        class="form-input" 
                        placeholder="Enter your name"
                        required
                        value="{{ request.form.get('name', '') if request.form else '' }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="email" class="form-label">Email *</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        placeholder="Enter your email"
                        required
                        value="{{ request.form.get('email', '') if request.form else '' }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="message" class="form-label">Message *</label>
                    <textarea 
                        id="message" 
                        name="message" 
                        class="form-textarea" 
                        placeholder="Enter your message"
                        required
                    >{{ request.form.get('message', '') if request.form else '' }}</textarea>
                </div>
                
                <button type="submit" class="submit-btn">Send Message</button>
            </form>
        </div>
        </div>
    </div>

    <!-- AI Assistant Button -->
    <button id="aiToggleBtn">ðŸ’¬</button>

    <!-- AI Panel -->
    <div id="aiPanel">
        <div id="aiPanelHeader">
            <span>DGIT AI Assistant</span>
            <button id="aiCloseBtn">âœ•</button>
        </div>
        <div id="aiMessageContainer"></div>
        <div id="aiInputContainer">
            <input type="text" id="aiInput" placeholder="Ask about genes, drugs, or proteins...">
            <button id="aiSend">Send</button>
        </div>
    </div>

    <!-- Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        let aiInteractions = [];

        // Toggle AI Panel
        document.getElementById('aiToggleBtn').addEventListener('click', function() {
            document.getElementById('aiPanel').classList.toggle('visible');
        });

        // Close AI Panel
        document.getElementById('aiCloseBtn').addEventListener('click', function() {
            document.getElementById('aiPanel').classList.remove('visible');
        });

        // Send AI message
        document.getElementById('aiSend').addEventListener('click', sendMessage);
        document.getElementById('aiInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const userInput = document.getElementById('aiInput').value.trim();
            if (!userInput) return;

            // Add user message to display
            appendMessage('You', userInput);
            document.getElementById('aiInput').value = '';

            // Send to backend
            fetch('/ask_ai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    question: userInput,
                    interactions: aiInteractions
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    appendMessage('AI Assistant', data.response);
                    aiInteractions = data.interactions || aiInteractions;
                } else if (data.error) {
                    appendMessage('AI Assistant', `Error: ${data.error}`);
                }
            })
            .catch(error => {
                appendMessage('AI Assistant', `Error: ${error.message}`);
            });
        }

        function appendMessage(sender, message) {
            const container = document.getElementById('aiMessageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message';
            
            const isUser = sender === 'You';
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${isUser ? message : marked.parse(message)}`;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
    </script>

</body>
</html>